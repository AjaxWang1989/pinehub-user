<template>
  <div class="body">
    <mp-title :title="title"></mp-title>
    <mp-swiper></mp-swiper>
    <div class="goods" >
        <menus @menusChange="menusChange"></menus>
        <m-list  :height="listHeight" :width="listwidth" model="" :next="next" :list="merchandises" 
        :addMerchandiseToCart = "addCart" :reduceMerchandiseToCart = "reduceCart" ></m-list>
    </div>
    <cart  v-if="isShowCart" @hdlShowPopup="hdlShowPopup" :emptyMerchandiseCart = "emptyCart" 
    :addMerchandiseToCart = "addCart"   :reduceMerchandiseToCart = "reduceCart"></cart>
    <pop-delivery v-if="isShow" @hdlHidePopup="hdlHidePopup"></pop-delivery>
  </div>
</template>

<script>
  import MpTitle from '@/components/MpTitle';
  import PopupDelivery from './PopupDelivery';
  import Swiper from '@/components/Swiper';
  import FoodsList from '@/components/FoodsList';
  import Menus from './Menus';
  import Cart from '@/components/Cart'
  export default{
    data(){
      return{
        title:"预定商城",
        isShow:false,
        isShowCart:true,
        activityId: 0, 
        screenHeight: '',
        categoryIndex:null,
      }
    },
    components: {
      'pop-delivery': PopupDelivery,
      'mp-swiper': Swiper,
      'menus': Menus,
      'm-list': FoodsList,
      'cart': Cart,
      "mp-title": MpTitle,
      
   },
    computed: {
      merchandises(){
        return this.$store.getters['model.reserveShop.merchandises/list'];
      },
      currentPage () {
       let page = this.$store.state['model.reserveShop.merchandises'].currentPage;
       console.log(page, "当前页数")
       return page;
      },
      categoryId() {
        console.log(this.$store.getters['model.categories/categoryId'](this.categoryIndex),"分类index")
        return this.$store.getters['model.categories/categoryId'](this.categoryIndex)
      }
   },
   watch: {
    categoryId() {
      this.loadMerchandises(1);
      console.log(this.loadMerchandises(1),"ghgggghhht4ethgtg")
    }
   },
    methods:{
      hdlShowCart:function(){
        this.isShowCart =  false;
      },
      hdlShowPopup:function(){
        this.isShow = true;

      },
      hdlHidePopup:function(){
        this.isShow = false;
      },
      loadMerchandises(page) {
        this.$command('GET_MERCHANDISE_LIST',
         'model.reserveShop.merchandises/setList', 
         'bookingMerchandises',
          this.categoryId, 
          page); 
          console.log('加载',  this.categoryId, page)  
      },
       menusChange : function (index) {
        this.index = index;
        this.loadMerchandises(this.currentPage  + 1);
      },
      next() {
        this.$command('GET_MERCHANDISE_LIST', 'model.activity.merchandises/setList', 'activity', this.activityId, this.currentPage + 1, this.pageCount);               
      },
      addCart(shopId, count,  merchandiseId){
        this.$command('ADD_MERCHANDISE_TO_CART', merchandiseId, count, shopId);
  
      },
      reduceCart(shopId, count, merchandiseId){
        console.log('ooooooooo');
        this.$command('REDUCE_MERCHANDISE_TO_CART',merchandiseId,count, shopId);
      },    
      emptyCart(storeId){
        this.$command('EMPTY_MERCHANDISES_TO_CART',storeId);
      }
    },
    created () {
      this.screenHeight = (750 / wx.getSystemInfoSync().windowWidth  * wx.getSystemInfoSync().windowHeight) + 'rpx';
   },


   mounted(){        
      this.$command('GET_CATEGORIES_TO_MEUN');
   }
}


</script>

<style scoped>

.goods{
  display: flex;
  width:100%;
  height: 100%;
  overflow: hidden;
  box-sizing: border-box;
  height: 100%;
  background: #f2f2f2;
}
</style>